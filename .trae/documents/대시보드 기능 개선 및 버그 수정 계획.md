# 대시보드 기능 개선 및 버그 수정 계획

사용자 요청에 따라 포트폴리오 리밸런싱 설정 저장 기능 구현 및 수익률 분석 오류 수정을 진행합니다. 모든 변경 사항은 UI/Logic 분리 원칙("Vibe Check")을 철저히 준수하여 구현합니다.

## 1. 데이터 및 타입 구조 개선 (Types & State Management)
사용자가 입력한 목표 비중(%)을 영구 저장하기 위해 데이터 구조를 확장합니다.
*   **파일**: `types/index.ts`, `types/store.ts`
*   **내용**:
    *   `PortfolioData` 인터페이스에 `allocationTargets` 필드 추가 (`Record<string, number>` 타입).
    *   `PortfolioActions` 인터페이스에 `updateAllocationTargets` 메서드 정의.

## 2. 데이터 저장소 및 동기화 로직 업데이트 (Services & Hooks)
Google Drive 연동 로직에 새로운 데이터 필드를 포함시킵니다.
*   **파일**: `hooks/useGoogleDriveSync.ts`, `hooks/usePortfolioData.ts`, `contexts/PortfolioContext.tsx`
*   **내용**:
    *   `usePortfolioData`에 `allocationTargets` 상태 관리 추가.
    *   Google Drive 저장/로드(`loadFromGoogleDrive`, `autoSave`) 시 `allocationTargets` 데이터 포함.
    *   Context를 통해 하위 컴포넌트에서 데이터 접근 및 수정 가능하도록 연결.

## 3. 포트폴리오 리밸런싱 기능 개선 (Rebalancing Feature)
기존 컴포넌트 내부의 계산 로직을 분리하고 저장 기능을 추가합니다.
*   **파일**: `components/dashboard/RebalancingTable.tsx` (UI), `hooks/useRebalancing.ts` (Logic - 신규 생성)
*   **내용**:
    *   **Logic 분리**: `useRebalancing.ts` 훅을 생성하여 현재 가치 계산, 목표 가치 계산, 비중 차이 계산 로직을 이동.
    *   **저장 기능**: '저장하기' 버튼 추가 및 클릭 시 `updateAllocationTargets` 호출.
    *   **UI 개선**: 컴포넌트는 순수하게 데이터 렌더링만 담당하도록 리팩토링.

## 4. 수익률 분석 오류 수정 (Yield Analysis Fixes)
수익률 계산 로직을 검증하고, 모든 자산이 포함되도록 수정하며 UI를 보완합니다.
*   **파일**: `components/dashboard/TopBottomAssets.tsx` (UI), `hooks/useTopBottomAssets.ts` (Logic - 신규 생성)
*   **내용**:
    *   **Logic 분리**: `useTopBottomAssets.ts` 훅을 생성하여 수익률 계산 및 정렬 로직 이동.
    *   **오류 수정**: 외화 자산의 원화 환산 가치 계산(`purchaseExchangeRate` 등 활용)을 정교화하여 모든 자산이 정상적으로 순위에 반영되도록 수정.
    *   **UI 개선**: 요청된 '수익금(평가손익)' 표시 확인 및 가독성 개선.

## 5. 실행 순서
1.  타입 정의 및 Context/Hook 업데이트 (기반 공사)
2.  `useRebalancing.ts` 및 `RebalancingTable.tsx` 구현 (저장 기능)
3.  `useTopBottomAssets.ts` 및 `TopBottomAssets.tsx` 구현 (오류 수정)
4.  검증 (기능 테스트)

위 계획대로 진행하여 안정적이고 유지보수 가능한 코드를 작성하겠습니다. 승인해 주시면 즉시 작업을 시작합니다.